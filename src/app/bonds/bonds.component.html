<!-- HEADER -->
<div class="header pt-4">
  <div class="container-fluid">

    <!-- Body -->
    <div class="header-body border-0 p-0">
      <div class="row align-items-end">
        <div class="col">
          <h1 class="mb-2">Purchase floating-rate bonds.
            Earn MPH rewards.</h1>
          <p class="text-muted font-weight-bold">
            Example: Chad purchases a floating-rate bond and fills up a debt of 5 tokens caused by Kevin's 1-year
            deposit
            of 100 tokens, to which a 5% fixed-rate interest was offered. Chad will earn floating-rate interest on 105
            tokens
            until
            Kevin withdraws his assets.
          </p>
          <p class="text-muted font-weight-bold mb-5">
            Because the fixed rate 88mph offers is 75% of the initial floating rate,
            Chad will be in profit as long as the floating rate doesn't drop by >25%, and his profit increases when the
            floating rate does. Chad is effectively longing the floating rate.
            <a class="text-purple" href="https://88mph.app/docs/" target="_blank" rel="noopener noreferrer">
              See how it works
            </a>
          </p>
          <div class="card-deck mt-4 mb-3">
            <div class="card mb-4 mb-lg-0">
              <div class="card-body pt-0">
                <!-- Title -->
                <h5 class="text-uppercase text-amber mt-n3 bg-dark pl-3">
                  You paid
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="The amount of debt your active bonds have funded.">
                    [i]
                  </button>
                </h5>

                <!-- Heading -->
                <h2 class="mb-0 glowing pl-3">
                  ${{totalDeficitFundedUSD.toFormat(4)}}
                </h2>
              </div>
            </div>
            <div class="card mb-4 mb-lg-0">
              <div class="card-body pt-0">
                <!-- Title -->
                <h5 class="text-uppercase text-amber mt-n3 bg-dark pl-3">
                  You earn on
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="The amount of deposits you're earning interest on.">
                    [i]
                  </button>
                </h5>

                <!-- Heading -->
                <h2 class="mb-1 glowing pl-3">
                  ${{totalCurrentDepositUSD.toFormat(4)}}
                </h2>
              </div>
            </div>
            <div class="card mb-4 mb-lg-0">
              <div class="card-body pt-0">
                <!-- Title -->
                <h5 class="text-uppercase text-amber mt-n3 bg-dark pl-3">
                  Interest paid out
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="The amount of interests you have earned so far from your active bonds. Interests will be automatically sent to your wallet when the depositors withdraw their deposits.">
                    [i]
                  </button>
                </h5>

                <!-- Heading -->
                <h2 class="mb-1 glowing pl-3">
                  ${{totalInterestUSD.toFormat(4)}}
                </h2>
                <h5 class="mb-0 text-white pl-3 d-none">Est. ROI 0.00%</h5>
              </div>
            </div>

            <div class="card mb-4 mb-lg-0">
              <div class="card-body pt-0">
                <!-- Title -->
                <h5 class="text-uppercase text-amber mt-n3 bg-dark pl-3">
                  MPH earned
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="Bond buyers earn MPH tokens that can be staked to earn rewards (protocol fees, harvested tokens, etc)">
                    [i]
                  </button>
                </h5>

                <!-- Heading -->
                <h2 class="mb-1 glowing pl-3">
                  {{totalMPHEarned.toFormat(4)}} MPH
                </h2>
                <h5 class="mb-0 text-white pl-3 d-none">$0.00</h5>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- / .row -->
    </div> <!-- / .header-body -->

  </div>
</div> <!-- / .header -->

<!-- CARDS -->
<div class="container-fluid mb-6">
  <div class="row">
    <div class="col-12">
      <!-- Current deposits -->
      <div class="card mb-6" *ngIf="funderPools.length">
        <h2 class="mt-n3 bg-dark mb-0 mx-3 pl-3">Active bonds</h2>
        <div class="table-responsive mb-0">
          <table class="table table-sm table-nowrap card-table">
            <thead>
              <tr>
                <th></th>
                <th class="text-white">
                  Amount paid
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="The amount of debt your bond have funded.">
                    [i]
                  </button>
                </th>
                <th class="text-white">
                  You earn interest on
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="The amount of deposits you're earning interest on.">
                    [i]
                  </button>
                </th>
                <th class="text-white">
                  Interest paid out
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="The amount of interests you have earned so far from your bond. Interests will be automatically sent to your wallet when the depositors withdraw their deposits.">
                    [i]
                  </button>
                </th>
                <th class="text-dark">
                  MPH rewards
                  <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                    ngbTooltip="Bond buyers earn upfront MPH tokens that can be staked to earn rewards (protocol fees, harvested tokens, etc)">
                    [i]
                  </button>
                </th>
              </tr>
            </thead>
            <tbody class="list">
              <ng-container *ngFor="let funderPool of funderPools">
                <tr>
                  <td>
                    <div class="d-flex align-items-center">

                      <!-- Image -->
                      <div class="avatar avatar-xs">
                        <img class="avatar-img rounded-circle mr-3" src={{funderPool.poolInfo.iconPath}} alt="...">
                      </div>

                      <div class="ml-3">

                        <!-- Heading -->
                        <h4 class="font-weight-normal mb-1">{{funderPool.poolInfo.name}}</h4>

                        <!-- Text -->
                        <small class="text-muted">{{funderPool.poolInfo.protocol}}</small>

                      </div>
                    </div>
                  </td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>

                <ng-container *ngFor="let funding of funderPool.fundings">
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">

                        <!-- Image -->
                        <h4 class="mb-0">#{{funding.nftID}}</h4>

                      </div>

                    </td>
                    <td>
                      <h4 class="mb-1 font-weight-normal glowing">${{funding.deficitUSD.toFormat(4)}}</h4>
                      <span class="text-white">{{funding.deficitToken.toFormat(4)}}
                        {{funderPool.poolInfo.stablecoinSymbol}}</span>
                    </td>
                    <td>
                      <h4 class="mb-1 font-weight-normal glowing">${{funding.currentDepositUSD.toFormat(4)}}</h4>
                      <span class="text-white">{{funding.currentDepositToken.toFormat(4)}}
                        {{funderPool.poolInfo.stablecoinSymbol}}</span>
                    </td>
                    <td>
                      <h4 class="mb-1 font-weight-normal glowing">${{funding.interestEarnedUSD.toFormat(4)}}</h4>
                      <span class="text-white">{{funding.interestEarnedToken.toFormat(4)}}
                        {{funderPool.poolInfo.stablecoinSymbol}}</span>
                    </td>
                    <td>
                      <h4 class="mb-1 font-weight-normal glowing">{{funding.mintMPHAmount.toFormat(4)}} MPH</h4>
                    </td>
                  </tr>
                </ng-container>
              </ng-container>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Deficit funding opportunities -->
      <div class="card">
        <h2 class="mt-n3 bg-dark mb-4 mx-3 pl-3">Buy floating-rate bonds</h2>
        <div class="card-body p-0">
          <h2 class="display-2 glowing text-center" *ngIf="loadingCalculator">
            Loading...
          </h2>
          <div class="row p-4" *ngIf="!loadingCalculator">
            <div class="col-12 col-lg-6">
              <div class="row pl-4 pr-4 pb-2">
                <label for="pool-select">Pool:</label>
                <select class="custom-select" id="pool-select" data-toggle="select"
                  (change)="selectPool($event.target.value)">
                  <option value={{i}} *ngFor="let pool of allPoolList; index as i;">
                    {{pool.name}}
                  </option>
                </select>
              </div>

              <ng-container *ngIf="selectedPoolHasDebt()">
                <div class="row pl-4 pr-4 mt-3">
                  <h4>
                    Your avg. floating-rate APY prediction: <strong>{{floatingRatePrediction.toFormat(4)}}%</strong>
                  </h4>
                  <h4>
                    (Does not affect the bond, only for estimation)
                  </h4>
                </div>

                <div class="pb-2 mt-3 pl-3 pr-3">
                  <input type="range" class="custom-range" min="0"
                    max={{selectedPool?.oneYearInterestRate.div(0.75).times(2).toFixed(4)}} step="0.0001"
                    [value]="floatingRatePrediction.toFixed(4)"
                    (input)="updateFloatingRatePrediction($event.target.value)">
                  <div class="row justify-content-between text-white px-4">
                    <div class="col">
                      <small>0%</small>
                    </div>
                    <div class="col text-center">
                      <small>{{selectedPool?.oneYearInterestRate.div(0.75).toFormat(4)}}% <br> (Current floating-rate APY)</small>
                    </div>
                    <div class="col text-right">
                      <small>{{selectedPool?.oneYearInterestRate.div(0.75).times(2).toFormat(4)}}%</small>
                    </div>
                  </div>
                </div>

                <div class="row pl-4 pr-4">
                  <h4>
                    Number of deposit debts to fund: <strong>{{numDepositsToFund}}</strong>
                  </h4>
                </div>

                <div class="pb-2 mt-3 pl-3 pr-3">
                  <input type="range" class="custom-range" min="1" [max]="numFundableDeposits + 1" step="1"
                    [value]="numFundableDeposits + 1" (input)="updateNumDepositsToFund($event.target.value)">
                  <div class="row justify-content-between text-white px-4">
                    <div class="col">
                      <small>1</small>
                    </div>
                    <div class="col text-right">
                      <small>All</small>
                    </div>
                  </div>
                </div>
              </ng-container>

            </div>
            <div class="col-12 col-lg-6">
              <ng-container *ngIf="!(debtToFundToken.gte(0) && selectedPoolHasDebt())">
                <h2 class="display-2 mb-4 glowing">
                  No debt available
                </h2>
              </ng-container>
              <ng-container *ngIf="debtToFundToken.gte(0) && selectedPoolHasDebt()">
                <h5 class="text-uppercase text-white">
                  Estimated ROI
                </h5>
                <h2 class="display-2 mb-4 glowing">
                  {{estimatedROI.toFormat(4)}}%
                </h2>
                <div class="row mb-4">
                  <div class="col-auto">
                    <h5 class="text-uppercase text-white">
                      You pay
                    </h5>
                    <h2 class="mb-1 glowing">
                      ${{debtToFundUSD.toFormat(4)}}
                    </h2>
                    <h5 class="mb-3 text-white">{{debtToFundToken.toFormat()}} {{selectedPool?.stablecoinSymbol}}</h5>
                  </div>
                  <div class="col-auto">
                    <h5 class="text-uppercase text-white">
                      You earn interest on
                    </h5>
                    <h2 class="mb-1 glowing">
                      ${{amountToEarnOnUSD.toFormat(4)}}
                    </h2>
                    <h5 class="mb-3 text-white">{{amountToEarnOnToken.toFormat(4)}} {{selectedPool?.stablecoinSymbol}}
                    </h5>
                  </div>
                </div>
                <div class="row">
                  <div class="col-auto">
                    <h5 class="text-uppercase text-white">
                      Estimated profit
                    </h5>
                    <h2 class="mb-1 glowing">
                      ${{estimatedProfitUSD.toFormat(4)}}
                    </h2>
                    <h5 class="mb-3 text-white">{{estimatedProfitToken.toFormat()}} {{selectedPool?.stablecoinSymbol}}
                    </h5>
                  </div>
                  <div class="col-auto">
                    <h5 class="text-uppercase text-white">
                      MPH rewards
                      <button type="button" class="btn btn-sm btn-link p-0 text-white" placement="top"
                        ngbTooltip="Bond buyers get rewarded with upfront MPH tokens that can be staked to earn rewards (protocol fees, harvested tokens, etc)">
                        [i]
                      </button>
                    </h5>
                    <h2 class="mb-1 glowing">
                      {{mphRewardAmount.toFormat(4)}} MPH
                    </h2>
                  </div>
                </div>
              </ng-container>
            </div>

            <button class="card-link btn-block m-3" [disabled]="debtToFundToken.lt(0)"
              *ngIf="selectedPoolHasDebt()" (click)="buyBond()">
              Continue
            </button>
          </div>

        </div>

      </div>

    </div>
  </div> <!-- / .row -->
</div>